# 基于IPv4的流媒体广播系统

## 介绍

基于Linux系统，一个简单的基于IPv4的流媒体项目，基于客户端/服务器（C/S）模型开发，采用了UDP组播技术，实现了MP3格式音乐广播系统。客户端使用多进程，父进程接收网络数据通过管道发送给子进程，子进程进程数据解码并输出到特定频道；服务器端采用多线程处理频道信息，实现MP3读取并使用令牌桶进行流量控制，通过UDP组播发送。

## 设计需求

1. 实现一个音乐广播系统
2. 考虑流量控制
3. 基于C/S模型，服务器设计成守护进程
4. 用户可通过节目单选择音乐频道

## 需求分析

1. 由于是一个广播系统，C/S之间的通讯采用无连接的 udp组播 ，组播相对于广播更加灵活并且节省资源，故采用组播技术。
2. 由于需要考虑到节目单频道，让用户可以提前了解到每一个频道的类型，所以在各音乐频道内容的基础上，加上节目单频道，这样无需遍历每一个频道，就可以知道各频道的内容，从而针对性的选择。因此需要规定节目单数据格式和节目频道数据格式。
3. 由于广播的内容是音乐，所以需要进行 流量控制 。流量控制采用 令牌桶 实现，可设置传输的速率。
4. 由于频道数目媒体库信息调整，故采用 多线程 获取并发送频道数据。不涉及多线程之间的通讯，需要考虑的令牌桶资源的互斥访问。
5. 服务器最后以 守护进程 方式运行，系统运行过程中的数据采用系统日志保存。

## 系统框架

![系统框架图](https://user-images.githubusercontent.com/46079639/174961551-a048afc3-6574-4b03-a8e9-a177e24031ed.jpg)


## 使用说明

1. 编译

    cd client/
    make
    cd ../server
    make

2. 设置本地媒体库

    |/var
    |--media
    |-- |-- ch1
    |-- |-- |-- desc.txt
    |-- |-- |-- xxxx.mp3     
    |-- |-- ch2
    |-- |-- |-- desc.txt
    |-- |-- |-- xxxx.mp3 
    |-- |-- ...

[注]

1. 使用的为mplayer，若你使用的为其他播放器，请到 client.h 中更改播放器。
2. 频道目录ch1，ch2，...位于/var/media目录下（如果不能进入/var目录，请转换成管理员用户）。
3. 每一个频道中有一个desc.txt文件（描述音乐信息）和一个xxxx.mp3文件（音乐文件）。

## 项目贡献者

1. B站up主 莫使金樽空对月_ （提供Linux系统编程视频）
2. 李慧芹 老师（视频讲解及部分代码实现）
3. astralcon（代码复现）
4. B站用户 小黄鸭boy （提供项目补充）

